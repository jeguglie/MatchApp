{"ast":null,"code":"var _jsxFileName = \"/Users/jv/Desktop/MatchApp/client/src/components/ModalChat/ModalChat.js\";\nimport React from 'react';\nimport { Form, Modal, Input, Icon } from 'semantic-ui-react';\nimport API from '../../utils/API';\nimport _ from \"lodash\";\n\nclass ModalChat extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.handleOpen = async user => {\n      this._mounted && this.setState({\n        showModal: true,\n        user: user\n      });\n      await API.getMessages(user.user_id).then(res => {\n        if (res.status === 200) this._mounted && this.setState({\n          messages: res.data.messages\n        }, () => {\n          this.innerRefScroll && this.innerRefScroll.current && this.innerRefScroll.current.scrollIntoView({\n            behavior: 'smooth',\n            block: 'end',\n            inline: 'end'\n          });\n        });\n      });\n    };\n\n    this.handleClose = () => {\n      this._mounted && this.setState({\n        showModal: false,\n        user: [],\n        messages: []\n      });\n    };\n\n    this.handleSend = async () => {\n      const message = this.innerRef && this.innerRef.current && this.innerRef.current.inputRef.current.value.toString();\n      const user_id = this.state.user.user_id;\n      console.log(this.innerRef.current); // Clear value in input\n\n      if (message && message.length) await API.sendMessage(user_id, message).then(res => {\n        if (res.status === 200) {\n          this.addMessage(message, true);\n          this._mounted && this.props.s_message_send(user_id, message);\n        }\n      });\n    };\n\n    this.addMessage = (message, user_id_emitter, user_id_receiver) => {\n      let messages = this.state.messages;\n      messages.push({\n        user_id: user_id_emitter,\n        user_id_dest: user_id_receiver,\n        timestamp: new Date().getDate(),\n        message: message\n      });\n      this._mounted && this.setState({\n        messages: messages\n      }, () => {\n        this.innerRefScroll && this.innerRefScroll.current && this.innerRefScroll.current.scrollIntoView({\n          behavior: 'smooth',\n          block: 'end',\n          inline: 'end'\n        });\n      });\n    };\n\n    this.handleChange = _.debounce((e, {\n      value\n    }) => {\n      this._mounted && this.setState({\n        message: value\n      });\n    }, 300);\n    this._mounted = false;\n    this.state = {\n      showModal: false,\n      user: [],\n      messages: [],\n      message: ''\n    };\n    this.innerRef = React.createRef();\n    this.innerRefScroll = React.createRef();\n  }\n\n  componentDidMount() {\n    this._mounted = true;\n  }\n\n  componentWillUnmount() {\n    this._mounted = false;\n  } // Outside Ref\n\n\n  render() {\n    const {\n      showModal,\n      user,\n      messages,\n      message\n    } = this.state;\n\n    function userOnline() {\n      if (user.online) return React.createElement(\"span\", {\n        className: 'OnlineChat',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 82\n        },\n        __self: this\n      }, \" \", React.createElement(Icon, {\n        name: 'circle',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 82\n        },\n        __self: this\n      }), \" \");else return React.createElement(\"span\", {\n        className: 'LastConnectionChat',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 84\n        },\n        __self: this\n      }, \" \", React.createElement(Icon, {\n        name: 'circle',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 84\n        },\n        __self: this\n      }), \" \");\n    }\n\n    function messagesRows() {\n      let user_id = user.user_id;\n\n      if (messages && messages.length) {\n        return messages.map((obj, i) => {\n          return React.createElement(\"div\", {\n            key: i,\n            className: obj.user_id === user_id ? 'yours messages' : 'mine messages',\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 91\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            className: 'message',\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 92\n            },\n            __self: this\n          }, React.createElement(\"p\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 93\n            },\n            __self: this\n          }, \" \", obj.message, \" \")));\n        });\n      }\n    }\n\n    return user ? React.createElement(Modal, {\n      className: 'ModalChat',\n      size: 'tiny',\n      open: showModal,\n      onClose: this.handleClose,\n      closeIcon: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102\n      },\n      __self: this\n    }, React.createElement(Modal.Header, {\n      className: 'HeaderChat',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108\n      },\n      __self: this\n    }, userOnline(), \" \", ' ', React.createElement(\"span\", {\n      className: 'chatUserBadge',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110\n      },\n      __self: this\n    }, user.firstname)), React.createElement(Modal.Content, {\n      scrolling: true,\n      className: 'ModalChatContent',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: 'messagesRows',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      ref: this.innerRefScroll,\n      className: 'chat',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114\n      },\n      __self: this\n    }, messagesRows()))), React.createElement(Modal.Actions, {\n      className: 'inputChat',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119\n      },\n      __self: this\n    }, React.createElement(Form, {\n      onSubmit: this.handleSend,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120\n      },\n      __self: this\n    }, React.createElement(Input, {\n      size: \"large\",\n      action: {\n        icon: 'send'\n      },\n      fluid: true,\n      ref: this.innerRef,\n      onChange: this.handleChange,\n      value: message,\n      placeholder: \"Type a message...\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121\n      },\n      __self: this\n    })))) : null;\n  }\n\n}\n\nexport default ModalChat;","map":{"version":3,"sources":["/Users/jv/Desktop/MatchApp/client/src/components/ModalChat/ModalChat.js"],"names":["React","Form","Modal","Input","Icon","API","_","ModalChat","Component","constructor","props","handleOpen","user","_mounted","setState","showModal","getMessages","user_id","then","res","status","messages","data","innerRefScroll","current","scrollIntoView","behavior","block","inline","handleClose","handleSend","message","innerRef","inputRef","value","toString","state","console","log","length","sendMessage","addMessage","s_message_send","user_id_emitter","user_id_receiver","push","user_id_dest","timestamp","Date","getDate","handleChange","debounce","e","createRef","componentDidMount","componentWillUnmount","render","userOnline","online","messagesRows","map","obj","i","firstname","icon"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Form, Modal, Input, Icon } from 'semantic-ui-react'\nimport API from '../../utils/API';\nimport _ from \"lodash\";\n\nclass ModalChat extends React.Component {\n    constructor(props){\n        super(props);\n        this._mounted = false;\n        this.state = {\n            showModal: false,\n            user: [],\n            messages: [],\n            message: ''\n        };\n        this.innerRef = React.createRef();\n        this.innerRefScroll = React.createRef();\n    }\n\n    componentDidMount() {\n        this._mounted = true;\n    }\n    componentWillUnmount() {\n        this._mounted = false;\n    }\n\n    // Outside Ref\n    handleOpen = async(user) => {\n        this._mounted && this.setState({showModal: true, user: user});\n        await API.getMessages(user.user_id)\n            .then(res => {\n                if (res.status === 200)\n                    this._mounted && this.setState({messages: res.data.messages}, () => {\n                        this.innerRefScroll && this.innerRefScroll.current && this.innerRefScroll.current.scrollIntoView({\n                            behavior: 'smooth',\n                            block: 'end',\n                            inline: 'end',\n                        });\n                    });\n            })\n    };\n    handleClose = () => {this._mounted && this.setState({showModal: false, user: [], messages: []})};\n    handleSend = async() => {\n        const message = this.innerRef && this.innerRef.current && this.innerRef.current.inputRef.current.value.toString();\n        const user_id = this.state.user.user_id;\n        console.log(this.innerRef.current);\n        // Clear value in input\n        if (message && message.length)\n            await API.sendMessage(user_id, message)\n                .then(res => {\n                    if (res.status === 200) {\n                        this.addMessage(message, true);\n                        this._mounted && this.props.s_message_send(user_id, message);\n                    }\n                })\n    };\n\n    addMessage = (message, user_id_emitter, user_id_receiver) => {\n        let messages = this.state.messages;\n        messages.push({\n            user_id: user_id_emitter,\n            user_id_dest: user_id_receiver,\n            timestamp: new Date().getDate(),\n            message: message\n        });\n        this._mounted && this.setState({messages: messages}, () => {\n            this.innerRefScroll && this.innerRefScroll.current && this.innerRefScroll.current.scrollIntoView({\n                behavior: 'smooth',\n                block: 'end',\n                inline: 'end',\n            });\n        });\n    };\n    handleChange = _.debounce((e, { value}) => {\n        this._mounted && this.setState({message: value});\n    }, 300);\n\n    render(){\n        const { showModal, user, messages, message } = this.state;\n        function userOnline() {\n            if (user.online)\n                return <span className={'OnlineChat'}> <Icon name={'circle'}/> </span>;\n            else\n                return <span className={'LastConnectionChat'}> <Icon name={'circle'}/> </span>\n        }\n        function messagesRows() {\n            let user_id = user.user_id;\n            if (messages && messages.length){\n                return messages.map( (obj, i) => {\n                    return (\n                        <div key={i} className={obj.user_id === user_id ? 'yours messages' : 'mine messages'}>\n                            <div  className={'message'}>\n                                <p> {obj.message} </p>\n                            </div>\n                        </div>\n                    )\n                })\n            }\n        }\n        return (\n            user ?\n                <Modal\n                    className={'ModalChat'}\n                    size={'tiny'}\n                    open={showModal}\n                    onClose={this.handleClose}\n                    closeIcon >\n                    <Modal.Header className={'HeaderChat'}>\n                        {userOnline()} {' '}\n                        <span className={'chatUserBadge'}>{user.firstname}</span>\n                    </Modal.Header>\n                    <Modal.Content scrolling className={'ModalChatContent'}>\n                        <div className={'messagesRows'}>\n                            <div ref={this.innerRefScroll} className={'chat'}>\n                                    {messagesRows()}\n                            </div>\n                        </div>\n                    </Modal.Content>\n                    <Modal.Actions className={'inputChat'}>\n                            <Form onSubmit={this.handleSend}>\n                                <Input\n                                    size='large'\n                                    action={{ icon: 'send' }}\n                                    fluid\n                                    ref={this.innerRef}\n                                    onChange={this.handleChange}\n                                    value={message}\n                                    placeholder='Type a message...'\n                                />\n                            </Form>\n                    </Modal.Actions>\n                </Modal> : null\n        )\n    }\n}\n\nexport default ModalChat;"]},"metadata":{},"sourceType":"module"}