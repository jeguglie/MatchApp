"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.searchEmails = searchEmails;
exports.searchAsciiEmails = searchAsciiEmails;
exports.searchUnicodeEmails = searchUnicodeEmails;
exports.default = void 0;

var _regexp = require("../regexp");

function searchEmails(input) {
  var unicode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;
  return (unicode ? searchUnicodeEmails : searchAsciiEmails)(input);
}

function searchAsciiEmails(input) {
  return search('ascii', _regexp.regexpAsciiEmail, input);
}

function searchUnicodeEmails(input) {
  return search('unicode', _regexp.regexpUnicodeEmail, input);
}

var _default = searchEmails;
exports.default = _default;

var search = function search(type, regexp, input) {
  var emails = ((typeof input === 'string' ? input : '').match(transform(type, regexp)) || []).filter(function (email) {
    return email.length <= 320 && email.slice(-1) !== '\n' && encodeURIComponent(email).replace(/%../g, 'x').length <= 320;
  });
  return emails.length ? emails : null;
};

var cache = Object.create(null);

var transform = function transform(type, regexp) {
  return cache[type] || (cache[type] = new RegExp(regexp.source.slice(1, -1), "".concat(regexp.flags, "g")));
};